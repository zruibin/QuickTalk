<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head>

<title>修改话题</title>

<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" >

<script src="/js/reqwest.min.js"></script>

<style>

textarea {width: 100%; font-size: 16px;}
#title {height: 30px}
#href {height: 30px}
#detail {height: 200px}
#content {height: 300px}

button {
	width: 80px;
	height: 40px;
}

#table,  #table td{border:1px solid #585858; line-height:22px;} 
#table td {padding: 10px 10px; word-break: break-all;}

</style>

</head>

<body>

title:<textarea id="title"></textarea>
href:<textarea id="href"></textarea>
detail:<textarea id="detail"></textarea>
content:<textarea id="content"></textarea>
<br>
<br>
<button onclick="submit();">提交</button>
<p id="result"></p>


</body>

<script>

function submit() {
	var result = document.getElementById("result");
	result.innerText = "";

	var title = document.getElementById("title");
	var titleText = title.value;
	var href = document.getElementById("href");
	var hrefText = href.value;
	var detail = document.getElementById("detail");
	var detailText = detail.value;
	var content = document.getElementById("content");
	var contentText = content.value;
	// console.log("title: " + title);
	// console.log("href: " + href);
	// console.log("detail: " + detail);
	// console.log("content: " + content);
	if (titleText.length == 0) {
		result.innerText = "title不可为空";
		return;
	}
	if (hrefText.length == 0) {
		result.innerText = "href不可为空";
		return;
	}
	if (detailText.length == 0) {
		result.innerText = "detail不可为空";
		return;
	}
	if (contentText.length == 0) {
		result.innerText = "content不可为空";
		return;
	}

	var url = "/service/quickTalk/changeTopic";
		reqwest({
			url: url, 
			type: 'json', 
			method: 'post',
			data: { 
				uuid: getQueryString("uuid"),
				title: titleText,
				href: hrefText,
				detail: detailText,
				content: contentText
			}
		}).then(function (response) {
			// response.data
			console.log(response);
			var result = document.getElementById("result");
			result.innerText = response.message;
		}).fail(function (err, msg) {
			console.log(err);     
			alert("请求失败，请重新刷新！");
		});
}

function getQueryString(name) 
{ 
    var url = location.search; //获取url中"?"符后的字串 
    // console.log('url: ' + url);
    var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i"); 
    var r = window.location.search.substr(1).match(reg); 
    if (r != null) return unescape(r[2]); return null; 
} 

function getTopic() {
	var url = "/service/quickTalk/topic?topic_uuid=" + getQueryString("uuid");
	reqwest({
		url: url, 
		type: 'json', 
		method: 'get'
	}).then(function (response) {
		console.log(response);
		var title = document.getElementById("title");
		title.value = response.data[0].title;
		var href = document.getElementById("href");
		href.value = response.data[0].href;
		var detail = document.getElementById("detail");
		detail.value = response.data[0].detail;
	}).fail(function (err, msg) {
		console.log(err);     
		alert("请求失败，请重新刷新！");
	});
}

function getTopicContent() {
	var url = "/service/quickTalk/topicContent?topic_uuid=" + getQueryString("uuid");
	reqwest({
		url: url, 
		type: 'json', 
		method: 'get'
	}).then(function (response) {
		console.log(url);
		console.log(response);
		var text = response.data.content;
		if (typeof(text) != "undefined") {
			var content = document.getElementById("content");
			content.value = text;
		}
		
	}).fail(function (err, msg) {
		console.log(err);     
		alert("请求失败，请重新刷新！");
	});
}

getTopic();
getTopicContent();




</script>

</html>